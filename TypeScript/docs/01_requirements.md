# 쇼핑몰 프로젝트 요구사항 명세서

## 1. 프로젝트 개요

| 항목 | 내용 |
|------|------|
| 프로젝트명 | NestShop (다나와 스타일 가격비교 쇼핑몰) |
| 기술 스택 | TypeScript, NestJS, TypeORM, PostgreSQL, Redis, Elasticsearch, JWT, WebSocket, Bull Queue, Nodemailer |
| 아키텍처 | REST API + WebSocket + Worker (Monolithic + Background Jobs) |
| 인증 방식 | JWT (Access Token + Refresh Token) |

---

## 2. 사용자 역할 (Roles)

| 역할 | 설명 |
|------|------|
| GUEST | 비회원. 상품 조회, 가격비교, 회원가입만 가능 |
| USER | 일반 회원. 주문, 장바구니, 리뷰, 위시리스트, 포인트, 채팅 사용 가능 |
| SELLER | 판매자. 자사 상품/가격 등록 및 관리 가능 |
| ADMIN | 관리자. 전체 시스템 관리, 판매처 관리, 추천/세일 설정 |

---

## 3. 기능 요구사항

### 3.1 회원 (Auth / User)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| AUTH-01 | 회원가입 | 이메일, 비밀번호, 이름, 전화번호 입력 | GUEST |
| AUTH-02 | 로그인 | 이메일 + 비밀번호, JWT 발급 | GUEST |
| AUTH-03 | 로그아웃 | Refresh Token 무효화 | USER, SELLER, ADMIN |
| AUTH-04 | 토큰 갱신 | Refresh Token으로 Access Token 재발급 | USER, SELLER, ADMIN |
| AUTH-05 | 이메일 인증 요청 | 회원가입 시 입력한 이메일로 인증 메일 발송 (6자리 인증코드, 유효시간 10분) | SYSTEM |
| AUTH-06 | 이메일 인증 확인 | 인증코드 입력하여 이메일 소유 확인 → 계정 활성화 (인증 전 로그인 불가) | GUEST |
| AUTH-07 | 인증 메일 재발송 | 인증코드 만료 시 재발송 요청 (Rate Limit: 1분 간격) | GUEST |
| AUTH-08 | 비밀번호 재설정 요청 | 이메일 + 전화번호 입력, 둘 다 일치 시 이메일로 재설정 인증코드 발송 | GUEST |
| AUTH-09 | 비밀번호 재설정 확인 | 인증코드 검증 → 비밀번호 재설정 토큰 발급 | GUEST |
| AUTH-10 | 비밀번호 재설정 | 재설정 토큰 + 새 비밀번호 입력으로 비밀번호 변경 | GUEST |
| USER-01 | 내 정보 조회 | 로그인한 사용자 정보 조회 | USER, SELLER, ADMIN |
| USER-02 | 내 정보 수정 | 이름, 전화번호, 비밀번호 변경 | USER, SELLER, ADMIN |
| USER-03 | 회원 탈퇴 | 소프트 삭제 처리 | USER |
| USER-04 | 회원 목록 조회 | 전체 회원 목록 (페이징) | ADMIN |
| USER-05 | 회원 상태 변경 | 활성/비활성/차단 처리 | ADMIN |

### 3.2 카테고리 (Category)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| CAT-01 | 카테고리 목록 조회 | 계층형 트리 구조로 조회 | ALL |
| CAT-02 | 카테고리 생성 | 이름, 부모 카테고리 지정 | ADMIN |
| CAT-03 | 카테고리 수정 | 이름, 정렬순서 변경 | ADMIN |
| CAT-04 | 카테고리 삭제 | 하위 카테고리 없을 때만 삭제 | ADMIN |

### 3.3 상품 (Product)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| PROD-01 | 상품 목록 조회 | 카테고리별, 검색, 정렬, 페이징, 스펙 필터 | ALL |
| PROD-02 | 상품 상세 조회 | 상품 정보 + 옵션 + 이미지 + 리뷰 + 판매처별 가격 | ALL |
| PROD-03 | 상품 등록 | 이름, 설명, 가격, 재고, 카테고리, 이미지, 옵션, 스펙 | ADMIN |
| PROD-04 | 상품 수정 | 상품 정보 전체 수정 | ADMIN |
| PROD-05 | 상품 삭제 | 소프트 삭제 | ADMIN |
| PROD-06 | 상품 옵션 관리 | 색상, 사이즈 등 옵션 CRUD | ADMIN |
| PROD-07 | 상품 이미지 관리 | 다중 이미지 업로드/삭제, 대표 이미지 지정 | ADMIN |

### 3.4 스펙 (Spec)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| SPEC-01 | 스펙 정의 관리 | 카테고리별 스펙 항목 정의 (CPU, RAM 등) | ADMIN |
| SPEC-02 | 상품 스펙 등록/수정 | 상품에 스펙 값 지정 | ADMIN |
| SPEC-03 | 스펙 기반 필터 | 카테고리 내 스펙 값으로 상품 필터링 | ALL |
| SPEC-04 | 상품 스펙 비교 | 2~4개 상품 스펙 나란히 비교 | ALL |

### 3.5 판매처 (Seller)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| SELL-01 | 판매처 목록 조회 | 등록된 판매처(쇼핑몰) 목록 | ALL |
| SELL-02 | 판매처 등록 | 판매처명, URL, 로고, 신뢰도 점수 | ADMIN |
| SELL-03 | 판매처 수정/삭제 | 판매처 정보 관리 | ADMIN |
| SELL-04 | 판매처별 가격 등록 | 특정 상품의 판매처별 가격 등록 | SELLER, ADMIN |
| SELL-05 | 판매처별 가격 조회 | 상품의 판매처별 가격 비교 목록 (최저가 순) | ALL |

### 3.6 가격비교 / 가격추이 (Price)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| PRICE-01 | 가격비교 조회 | 상품의 판매처별 가격 비교 (최저가, 평균가, 최고가) | ALL |
| PRICE-02 | 가격 추이 조회 | 상품의 가격 변동 이력 (일별/주별/월별 그래프 데이터) | ALL |
| PRICE-03 | 최저가 알림 등록 | 목표가 설정 → 해당가 도달 시 알림 | USER |
| PRICE-04 | 최저가 알림 목록 | 내 알림 설정 목록 | USER |
| PRICE-05 | 최저가 알림 삭제 | 알림 해제 | USER |

### 3.7 장바구니 (Cart)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| CART-01 | 장바구니 조회 | 내 장바구니 목록 | USER |
| CART-02 | 장바구니 추가 | 상품 + 옵션 + 수량 + 판매처 추가 | USER |
| CART-03 | 장바구니 수량 변경 | 수량 증가/감소 | USER |
| CART-04 | 장바구니 항목 삭제 | 개별/선택 삭제 | USER |
| CART-05 | 장바구니 비우기 | 전체 삭제 | USER |

### 3.8 주문 (Order)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| ORD-01 | 주문 생성 | 장바구니/바로구매 → 주문 생성, 재고 차감, 포인트 사용 | USER |
| ORD-02 | 내 주문 목록 | 주문 내역 조회 (페이징) | USER |
| ORD-03 | 주문 상세 조회 | 주문 상품, 배송 정보, 결제 정보 | USER |
| ORD-04 | 주문 취소 | 결제 전/입금 대기 상태에서 취소, 포인트 환원 | USER |
| ORD-05 | 전체 주문 관리 | 전체 주문 목록 조회 (필터, 페이징) | ADMIN |
| ORD-06 | 주문 상태 변경 | 입금확인, 배송준비, 배송중, 배송완료 | ADMIN |

### 3.9 결제 (Payment)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| PAY-01 | 결제 요청 | 주문에 대한 결제 처리 (모의 결제) | USER |
| PAY-02 | 결제 확인 | 결제 상태 조회 | USER |
| PAY-03 | 환불 처리 | 주문 취소 시 환불 | USER, ADMIN |

### 3.10 배송지 (Address)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| ADDR-01 | 배송지 목록 조회 | 내 배송지 목록 | USER |
| ADDR-02 | 배송지 추가 | 수령인, 주소, 전화번호, 기본 배송지 여부 | USER |
| ADDR-03 | 배송지 수정 | 배송지 정보 수정 | USER |
| ADDR-04 | 배송지 삭제 | 배송지 삭제 | USER |

### 3.11 리뷰 (Review)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| REV-01 | 리뷰 작성 | 구매 확정된 상품에 별점 + 내용, 포인트 적립 | USER |
| REV-02 | 리뷰 수정 | 본인 리뷰 수정 | USER |
| REV-03 | 리뷰 삭제 | 본인 리뷰 삭제 / 관리자 삭제 | USER, ADMIN |
| REV-04 | 상품 리뷰 조회 | 특정 상품의 리뷰 목록 (페이징) | ALL |

### 3.12 위시리스트 (Wishlist)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| WISH-01 | 위시리스트 조회 | 내 위시리스트 목록 | USER |
| WISH-02 | 위시리스트 추가 | 상품 찜하기 (토글) | USER |
| WISH-03 | 위시리스트 삭제 | 찜 해제 | USER |

### 3.13 포인트 (Point)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| PNT-01 | 포인트 잔액 조회 | 내 현재 포인트 | USER |
| PNT-02 | 포인트 내역 조회 | 적립/사용 내역 (페이징) | USER |
| PNT-03 | 포인트 적립 | 구매확정, 리뷰작성 시 자동 적립 | SYSTEM |
| PNT-04 | 포인트 사용 | 주문 시 포인트 차감 | USER |
| PNT-05 | 포인트 환원 | 주문 취소 시 사용 포인트 환원 | SYSTEM |
| PNT-06 | 관리자 포인트 지급 | 이벤트 등 수동 포인트 지급 | ADMIN |

### 3.14 커뮤니티 / 게시판 (Community)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| COMM-01 | 게시판 목록 조회 | 사용기, Q&A, 자유게시판 등 | ALL |
| COMM-02 | 게시글 목록 조회 | 게시판별 글 목록 (페이징, 검색, 정렬) | ALL |
| COMM-03 | 게시글 상세 조회 | 글 내용 + 댓글 + 조회수 증가 | ALL |
| COMM-04 | 게시글 작성 | 제목, 내용, 이미지, 카테고리 태그 | USER |
| COMM-05 | 게시글 수정 | 본인 글 수정 | USER |
| COMM-06 | 게시글 삭제 | 본인 삭제 / 관리자 삭제 | USER, ADMIN |
| COMM-07 | 댓글 작성 | 게시글에 댓글 (대댓글 지원) | USER |
| COMM-08 | 댓글 삭제 | 본인 삭제 / 관리자 삭제 | USER, ADMIN |
| COMM-09 | 게시글 좋아요 | 좋아요 토글 | USER |

### 3.15 문의 (Inquiry)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| INQ-01 | 상품 문의 작성 | 특정 상품에 대한 질문 (비밀글 가능) | USER |
| INQ-02 | 상품 문의 목록 | 상품별 문의 목록 (페이징) | ALL |
| INQ-03 | 문의 답변 | 관리자/판매자가 답변 | SELLER, ADMIN |
| INQ-04 | 내 문의 목록 | 내가 작성한 문의 내역 | USER |
| INQ-05 | 문의 삭제 | 본인 삭제 (답변 전만 가능) | USER |

### 3.16 고객센터 (Support)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| SUP-01 | 1:1 문의 작성 | 카테고리 선택 + 제목 + 내용 + 첨부파일 | USER |
| SUP-02 | 1:1 문의 목록 | 내 문의 내역 (상태별 필터) | USER |
| SUP-03 | 1:1 문의 상세 | 문의 + 답변 대화 스레드 | USER |
| SUP-04 | 1:1 문의 답변 | 관리자 답변 작성 | ADMIN |
| SUP-05 | 전체 문의 관리 | 전체 1:1 문의 목록 (필터, 검색) | ADMIN |

### 3.17 서비스 도움말 / FAQ (Help)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| FAQ-01 | FAQ 목록 조회 | 카테고리별 자주 묻는 질문 | ALL |
| FAQ-02 | FAQ 검색 | 키워드로 FAQ 검색 | ALL |
| FAQ-03 | FAQ 등록 | 질문 + 답변 등록 | ADMIN |
| FAQ-04 | FAQ 수정/삭제 | FAQ 관리 | ADMIN |
| FAQ-05 | 공지사항 목록 | 서비스 공지사항 | ALL |
| FAQ-06 | 공지사항 관리 | 공지 CRUD | ADMIN |

### 3.18 활동 내역 (Activity)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| ACT-01 | 활동 내역 조회 | 최근 본 상품, 검색 기록, 주문 이력 통합 | USER |
| ACT-02 | 최근 본 상품 | 최근 조회한 상품 목록 (최대 50개) | USER |
| ACT-03 | 검색 기록 | 최근 검색어 목록 | USER |
| ACT-04 | 검색 기록 삭제 | 개별/전체 삭제 | USER |

### 3.19 실시간 채팅 (Chat)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| CHAT-01 | 채팅방 생성 | 고객 ↔ 상담원 1:1 채팅방 개설 | USER |
| CHAT-02 | 메시지 전송 | WebSocket 실시간 메시지 전송 | USER, ADMIN |
| CHAT-03 | 채팅 기록 조회 | 이전 대화 내역 조회 (페이징) | USER, ADMIN |
| CHAT-04 | 채팅방 목록 | 내 채팅방 / 전체 채팅방 (관리자) | USER, ADMIN |
| CHAT-05 | 채팅방 종료 | 상담 종료 처리 | USER, ADMIN |
| CHAT-06 | 읽음 처리 | 메시지 읽음 상태 실시간 동기화 | USER, ADMIN |

### 3.20 랭킹 / 인기차트 (Ranking)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| RANK-01 | 인기 상품 랭킹 | 카테고리별 조회수/판매량 기반 TOP N | ALL |
| RANK-02 | 실시간 검색어 | 인기 검색어 TOP 10 (Redis) | ALL |
| RANK-03 | 가격 하락 랭킹 | 최근 가격 하락폭 큰 상품 | ALL |
| RANK-04 | 랭킹 데이터 갱신 | 스케줄러로 주기적 갱신 (1시간) | SYSTEM |

### 3.21 오늘의 상품 추천 (Recommendation)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| REC-01 | 추천 상품 조회 | 메인 페이지 추천 상품 목록 | ALL |
| REC-02 | 맞춤 추천 | 최근 본 상품/구매 이력 기반 추천 | USER |
| REC-03 | 추천 상품 설정 | 관리자가 수동으로 추천 상품 지정 | ADMIN |
| REC-04 | 추천 상품 해제 | 추천 해제 | ADMIN |

### 3.22 특가 세일 (Deal)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| DEAL-01 | 특가 목록 조회 | 진행 중인 특가/세일 목록 | ALL |
| DEAL-02 | 특가 상세 조회 | 세일 정보 + 할인율 + 남은 시간 + 대상 상품 | ALL |
| DEAL-03 | 특가 생성 | 세일명, 기간, 할인율, 대상 상품 지정 | ADMIN |
| DEAL-04 | 특가 수정/삭제 | 세일 정보 관리 | ADMIN |
| DEAL-05 | 타임세일 | 시간 제한 특가 (카운트다운) | ALL |

### 3.23 고급 검색 엔진 (Search)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| SRCH-01 | 전문 검색 | Elasticsearch 기반 상품 검색 (형태소 분석, 오타 보정) | ALL |
| SRCH-02 | 자동완성 | 검색어 입력 시 실시간 자동완성 (debounce 300ms) | ALL |
| SRCH-03 | 검색 필터 | 카테고리, 가격대, 스펙, 판매처, 평점 복합 필터 | ALL |
| SRCH-04 | 연관 검색어 | 검색 결과 페이지에 관련 검색어 제안 | ALL |
| SRCH-05 | 검색 로그 수집 | 검색어, 클릭 상품, 검색 결과 수 등 로그 수집 (분석용) | SYSTEM |
| SRCH-06 | 검색 가중치 관리 | 상품명, 브랜드, 스펙 등 필드별 검색 가중치 설정 | ADMIN |

### 3.24 스펙 비교 엔진 고도화 (Spec Engine)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| SENG-01 | 동적 스펙 스키마 | 카테고리별 스펙 템플릿 상속 (노트북 → 게이밍 노트북) | ADMIN |
| SENG-02 | 스펙 그룹핑 | 스펙을 그룹별로 분류 (기본정보, 성능, 디스플레이 등) | ADMIN |
| SENG-03 | 수치 스펙 비교 | 수치형 스펙 자동 하이라이트 (높을수록 좋음/낮을수록 좋음) | ALL |
| SENG-04 | 스펙 점수 산출 | 카테고리별 가중치 기반 종합 성능 점수 계산 | ALL |
| SENG-05 | 유사 상품 추천 | 스펙 유사도 기반 대안 상품 자동 추천 | ALL |

### 3.25 크롤링 / 데이터 파이프라인 (Crawler)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| CRAW-01 | 크롤러 작업 관리 | 판매처별 크롤링 스케줄 등록/수정/삭제 | ADMIN |
| CRAW-02 | 가격 수집 | 판매처 사이트에서 가격 자동 수집 (Bull Queue Worker) | SYSTEM |
| CRAW-03 | 스펙 수집 | 상품 스펙 정보 자동 수집 및 매핑 | SYSTEM |
| CRAW-04 | 수집 상태 모니터링 | 크롤러 실행 이력, 성공/실패율, 최근 수집 시각 | ADMIN |
| CRAW-05 | 수집 데이터 검증 | 이상치 탐지 (급격한 가격 변동 알림) | SYSTEM |
| CRAW-06 | 수동 수집 트리거 | 특정 상품/판매처 즉시 수집 | ADMIN |

### 3.26 가격 변동 예측 (Price Prediction)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| PRED-01 | 가격 추세 분석 | 이동평균선 기반 상승/하락/보합 판단 | ALL |
| PRED-02 | 구매 타이밍 추천 | "지금 사세요" / "좀 더 기다리세요" 안내 | ALL |
| PRED-03 | 예상 최저가 | 과거 패턴 기반 향후 2주 예상 최저가 표시 | ALL |
| PRED-04 | 계절성 분석 | 연간 가격 패턴 (블프, 설날 등) 기반 할인 시기 예측 | ALL |

### 3.27 브라우저 푸시 알림 (Web Push)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| PUSH-01 | 푸시 구독 등록 | Web Push API 구독 (VAPID 키 기반) | USER |
| PUSH-02 | 푸시 구독 해제 | 구독 취소 | USER |
| PUSH-03 | 최저가 도달 알림 | 목표가 도달 시 브라우저 푸시 전송 | SYSTEM |
| PUSH-04 | 주문 상태 알림 | 배송 상태 변경 시 푸시 | SYSTEM |
| PUSH-05 | 채팅 메시지 알림 | 새 채팅 메시지 시 푸시 (비활성 탭) | SYSTEM |
| PUSH-06 | 특가 시작 알림 | 관심 카테고리 특가 시작 시 푸시 | SYSTEM |
| PUSH-07 | 알림 설정 관리 | 알림 유형별 on/off 설정 | USER |

### 3.28 판매처 신뢰도 알고리즘 (Trust Score)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| TRUST-01 | 신뢰도 산출 | 복합 지표 기반 판매처 점수 자동 계산 (0~100) | SYSTEM |
| TRUST-02 | 신뢰도 지표 | 배송 정확도, 가격 정확도, 고객 평점, 응답 속도, 반품률 | SYSTEM |
| TRUST-03 | 신뢰도 이력 | 월별 신뢰도 변화 추이 | ALL |
| TRUST-04 | 판매처 리포트 | 판매처별 성과 대시보드 (관리자용) | ADMIN |
| TRUST-05 | 경고 시스템 | 신뢰도 급락 판매처 자동 경고/비활성화 | SYSTEM |

### 3.29 다국어 / 다화폐 (i18n)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| I18N-01 | 다국어 응답 | Accept-Language 헤더 기반 응답 언어 전환 (ko/en/ja) | ALL |
| I18N-02 | 번역 리소스 관리 | 에러 메시지, UI 텍스트 번역 관리 | ADMIN |
| I18N-03 | 다화폐 표시 | 상품 가격을 사용자 설정 통화로 변환 표시 (KRW/USD/JPY) | ALL |
| I18N-04 | 환율 자동 갱신 | 외부 API로 일별 환율 갱신 (Cron) | SYSTEM |
| I18N-05 | 사용자 언어 설정 | 내 프로필에서 언어/화폐 기본값 설정 | USER |

### 3.30 이미지 최적화 (Image)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| IMG-01 | 자동 리사이징 | 업로드 시 썸네일(200px), 중간(600px), 원본 3종 자동 생성 | SYSTEM |
| IMG-02 | WebP 변환 | 원본 이미지를 WebP 포맷으로 자동 변환 (용량 40%↓) | SYSTEM |
| IMG-03 | Lazy Loading URL | 블러 처리된 초저해상도 placeholder 이미지 생성 | SYSTEM |
| IMG-04 | CDN 연동 | 이미지 서빙 시 CDN URL 매핑 | SYSTEM |
| IMG-05 | 이미지 메타데이터 | 원본 크기, 변환 크기, 포맷, 용량 등 기록 | SYSTEM |

### 3.31 배지 시스템 (Badge)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| BADGE-01 | 배지 정의 관리 | 배지 종류 CRUD (전문가, 인플루언서, 파워리뷰어 등) | ADMIN |
| BADGE-02 | 배지 자동 부여 | 조건 달성 시 자동 부여 (리뷰 50개 → 파워리뷰어) | SYSTEM |
| BADGE-03 | 배지 수동 부여 | 관리자가 특정 사용자에게 수동 부여 (전문가, 인플루언서) | ADMIN |
| BADGE-04 | 내 배지 조회 | 보유 배지 목록 | USER |
| BADGE-05 | 배지 표시 | 리뷰, 게시글, 댓글에 배지 아이콘 노출 | ALL |
| BADGE-06 | 배지 혜택 | 배지별 추가 포인트 적립률, 우선 노출 등 | SYSTEM |

### 3.32 PC 견적 짜기 (PC Configurator)

| ID | 기능 | 설명 | 권한 |
|----|------|------|------|
| PCBLD-01 | 견적 시작 | 용도 선택 (게이밍, 사무, 영상편집 등) → 추천 구성 | ALL |
| PCBLD-02 | 파트 카테고리 | CPU, 메인보드, RAM, GPU, SSD, 파워, 케이스, 쿨러 슬롯 | ALL |
| PCBLD-03 | 호환성 검증 | 소켓, 폼팩터, 전력 등 실시간 호환성 체크 | ALL |
| PCBLD-04 | 병목 현상 탐지 | CPU↔GPU 밸런스 경고, RAM 부족 경고 | ALL |
| PCBLD-05 | 견적 총액/최저가 | 모든 파트의 판매처별 최저가 합산 | ALL |
| PCBLD-06 | 견적 저장/불러오기 | 내 견적 저장, 공유 링크 생성 | USER |
| PCBLD-07 | 견적 공유 | 커뮤니티에 견적 공유 게시 | USER |
| PCBLD-08 | 인기 견적 | 다른 사용자들의 인기 견적 목록 | ALL |
| PCBLD-09 | 견적 한번에 구매 | 견적 내 전체 파트 장바구니 일괄 추가 | USER |

---

## 4. 비기능 요구사항

### 4.1 보안
- 비밀번호 bcrypt 해싱 (saltRounds: 10)
- JWT Access Token 만료: 30분, Refresh Token 만료: 7일
- Rate Limiting: 분당 60회 (인증 관련 API는 분당 10회)
- CORS 설정
- Helmet 미들웨어 적용
- SQL Injection / XSS 방어 (TypeORM 파라미터 바인딩)
- WebSocket 연결 시 JWT 인증 검증
- Web Push VAPID 키 관리 (서버 사이드)
- 회원가입 이메일 인증 필수 (인증 전 로그인 차단)
- 이메일 인증코드: 6자리 숫자, 유효시간 10분, 최대 시도 5회
- 비밀번호 재설정: 이메일 + 전화번호 이중 검증 후 인증코드 발송
- 인증 메일 발송 Rate Limit: 동일 이메일 1분 간격 제한

### 4.2 성능
- 목록 API 페이징 필수 (기본 20건, 최대 100건)
- 상품 목록/가격비교 캐싱 (Redis, TTL 5분)
- 인기 검색어/랭킹 캐싱 (Redis, TTL 1시간)
- 이미지 업로드 용량 제한 (5MB), 자동 WebP 변환
- DB 인덱스 최적화 (검색/정렬 대상 컬럼)
- WebSocket 연결 풀 관리 (Redis Adapter)
- Elasticsearch 인덱스 최적화 (한국어 nori 분석기)
- 이미지 3종 자동 리사이징 (썸네일/중간/원본)

### 4.3 데이터
- 모든 엔티티에 createdAt, updatedAt 자동 기록
- 삭제는 소프트 삭제 (deletedAt) 적용
- 주문번호: `ORD-{yyyyMMdd}-{난수6자리}` 형식
- 가격 이력 일별 스냅샷 저장 (Cron Job, 매일 00:00)
- 포인트 적립률: 구매확정 1%, 리뷰작성 500P 고정
- 크롤링 데이터는 Bull Queue로 비동기 처리
- 검색 인덱스는 DB 변경 시 이벤트 기반 동기화

### 4.4 실시간 / 알림
- 채팅: WebSocket (Socket.IO) + Redis Pub/Sub
- 최저가 알림: 가격 갱신 시 WebSocket + Web Push 동시 전송
- 실시간 검색어: Redis Sorted Set, 5분 간격 갱신
- 브라우저 푸시: Web Push API (VAPID), Service Worker 연동
- 알림 유형별 개별 on/off 설정 지원

### 4.5 검색
- Elasticsearch 기반 전문 검색 (한국어 nori 토크나이저)
- 자동완성: Edge N-gram + Completion Suggester
- 오타 보정: Fuzzy Query (fuzziness: AUTO)
- 검색 가중치: 상품명(10) > 브랜드(5) > 스펙(3) > 설명(1)
- 검색 로그 수집 → 인기 검색어, 연관 검색어 분석

### 4.6 트랜잭션 / 동시성
- 주문 생성: `SERIALIZABLE` (재고 차감 원자성)
- 포인트 적립/사용: `REPEATABLE READ` (잔액 일관성)
- 가격 수집/갱신: `READ COMMITTED` (일반)
- 비관적 잠금: 재고 차감 시 `FOR UPDATE`
- 낙관적 잠금: 상품 수정 시 `@VersionColumn`

### 4.7 다국어 / 다화폐
- 지원 언어: ko (기본), en, ja
- Accept-Language 헤더 기반 자동 전환
- 에러 메시지, 시스템 텍스트 다국어 번역 파일 관리
- 환율: 외부 API 일 1회 자동 갱신, Redis 캐싱
- 지원 통화: KRW (기본), USD, JPY

### 4.8 로깅 / 모니터링
- 요청/응답 로깅 (Interceptor)
- 에러 로깅 (Exception Filter)
- 환경별 로그 레벨 분리 (dev: debug, prod: warn)
- 활동 이력 비동기 저장 (Queue)
- 크롤러 실행 이력 기록 (성공/실패/소요시간)

### 4.6 API 응답 형식

```json
// 성공
{
  "success": true,
  "data": { ... },
  "meta": {
    "page": 1,
    "limit": 20,
    "totalCount": 150,
    "totalPages": 8
  }
}

// 실패
{
  "success": false,
  "error": {
    "code": "PRODUCT_NOT_FOUND",
    "message": "상품을 찾을 수 없습니다."
  }
}
```

---

## 5. 주문 상태 흐름

```
ORDER_PLACED (주문완료)
    ↓
PAYMENT_PENDING (입금대기)
    ↓
PAYMENT_CONFIRMED (입금확인)
    ↓
PREPARING (배송준비)
    ↓
SHIPPING (배송중)
    ↓
DELIVERED (배송완료)
    ↓
CONFIRMED (구매확정) → 포인트 적립 (결제금액 × 1%)

※ 취소 가능 시점: ORDER_PLACED, PAYMENT_PENDING
   ORDER_PLACED / PAYMENT_PENDING → CANCELLED (주문취소) → 포인트 환원
   DELIVERED 이후 → RETURN_REQUESTED (반품요청) → RETURNED (반품완료)
```

---

## 6. 포인트 정책

```
[적립]
- 구매확정 시: 결제금액 × 1%
- 리뷰 작성 시: 500P 고정
- 관리자 수동 지급: 이벤트, 보상 등

[사용]
- 주문 시 포인트 차감 (1P = 1원)
- 최소 사용 단위: 1,000P
- 최대 사용: 결제금액의 50%

[환원]
- 주문 취소 시 사용 포인트 전액 환원
- 적립 포인트 회수

[만료]
- 적립일로부터 1년 후 만료
```
